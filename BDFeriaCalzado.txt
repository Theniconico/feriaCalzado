CREATE SCHEMA IF NOT EXISTS `feriaCalzado` DEFAULT CHARACTER SET latin1 ;
USE `feriaCalzado` ;

CREATE TABLE `carrito` (
`id` INT(11) NOT NULL AUTO_INCREMENT UNIQUE,
  `id_producto` INT(11) NOT NULL,
  `cantidad` DOUBLE NOT NULL,
  `id_usuario` INT(11) NOT NULL,
  PRIMARY KEY (`id`)
)
ENGINE = InnoDB
DEFAULT CHARACTER SET = latin1;

CREATE TABLE `categorias` (
  `id` INT(11) NOT NULL AUTO_INCREMENT UNIQUE,
  `nombre` VARCHAR(100) NOT NULL,
  `descripcion` VARCHAR(400) NOT NULL,
  `imagen` VARCHAR(400) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `id_UNIQUE` (`id` ASC) )
ENGINE = InnoDB
AUTO_INCREMENT = 4
DEFAULT CHARACTER SET = latin1;

CREATE TABLE `cargo` (
  `id_cargo` INT NOT NULL AUTO_INCREMENT,
  `nombre_cargo` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`id_cargo`),
  UNIQUE INDEX `id_cargo_UNIQUE` (`id_cargo` ASC) )
ENGINE = InnoDB;

CREATE TABLE `usuario` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `email` VARCHAR(200) NOT NULL,
  `password` VARCHAR(100) NOT NULL,
  `img_perfil` VARCHAR(300) NOT NULL,
  `id_cargo` INT NOT NULL,
  PRIMARY KEY (`id`),
  INDEX `id_cargo_idx` (`id_cargo` ASC) ,
  UNIQUE INDEX `id_UNIQUE` (`id` ASC) ,
  CONSTRAINT `id_cargo`
    FOREIGN KEY (`id_cargo`)
    REFERENCES `feriacalzado`.`cargo` (`id_cargo`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
AUTO_INCREMENT = 13
DEFAULT CHARACTER SET = latin1;

CREATE TABLE `cliente` (
  `id_cliente` INT NOT NULL AUTO_INCREMENT,
  `nombre` VARCHAR(100) NULL,
  `rut` VARCHAR(45) NOT NULL,
  `telefono` VARCHAR(45) NOT NULL,
  `direccion` VARCHAR(100) NOT NULL,
  PRIMARY KEY (`id_cliente`),
  UNIQUE INDEX `id_cliente_UNIQUE` (`id_cliente` ASC) )
ENGINE = InnoDB;

CREATE TABLE `pedido` (
  `id_pedido` INT NOT NULL AUTO_INCREMENT,
  `direccion` VARCHAR(100) NOT NULL,
  `region` VARCHAR(50) NOT NULL,
  `cp` VARCHAR(20) NOT NULL,
  `ciudad` VARCHAR(20) NOT NULL,
  `fecha` DATETIME NOT NULL,
  `fecha_entrega` DATETIME NOT NULL,
  `id_cliente` INT NOT NULL,
  `id_usuario` INT NOT NULL,
  PRIMARY KEY (`id_pedido`),
  UNIQUE INDEX `id_pedido_UNIQUE` (`id_pedido` ASC) ,
  INDEX `id_usuario_idx` (`id_usuario` ASC) ,
  INDEX `id_cliente_idx` (`id_cliente` ASC) ,
  CONSTRAINT `id_usuario`
    FOREIGN KEY (`id_usuario`)
    REFERENCES `feriacalzado`.`usuario` (`id`),
  CONSTRAINT `id_cliente`
    FOREIGN KEY (`id_cliente`)
    REFERENCES `feriacalzado`.`cliente` (`id_cliente`))
ENGINE = InnoDB
AUTO_INCREMENT = 8
DEFAULT CHARACTER SET = latin1;

CREATE TABLE `productos` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `nombre` VARCHAR(300) NOT NULL,
  `descripcion` TEXT NOT NULL,
  `precio_compra` INT NOT NULL,
  `imagen` VARCHAR(200) NOT NULL,
  `stock` INT(11) NOT NULL,
  `id_categoria` INT(11) NOT NULL,
  `talla` VARCHAR(100) NOT NULL,
  `color` VARCHAR(100) NOT NULL,
  `estado` TINYINT NOT NULL,
  `precio_venta` INT NOT NULL,
  `id_detalleProducto` INT NOT NULL,
  PRIMARY KEY (`id`),
  INDEX `id_categoria_idx` (`id_categoria` ASC) ,
  UNIQUE INDEX `id_UNIQUE` (`id` ASC) ,
  CONSTRAINT `id_categoria`
    FOREIGN KEY (`id_categoria`)
    REFERENCES `feriacalzado`.`categorias` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
AUTO_INCREMENT = 56
DEFAULT CHARACTER SET = latin1;

CREATE TABLE `pago` (
  `id_pago` INT(11) NOT NULL AUTO_INCREMENT,
  `id_pedido` INT(11) NOT NULL,
  `medio_pago` VARCHAR(50) NOT NULL,
  `total` INT NOT NULL,
  PRIMARY KEY (`id_pago`),
  UNIQUE INDEX `id_pago_UNIQUE` (`id_pago` ASC) ,
  CONSTRAINT `id_pedido`
    FOREIGN KEY (`id_pedido`)
    REFERENCES `feriacalzado`.`pedido` (`id_pedido`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
AUTO_INCREMENT = 23
DEFAULT CHARACTER SET = latin1;

CREATE TABLE `detalle_pedido` (
  `id_detallePedido` INT NOT NULL AUTO_INCREMENT,
  `id_pedido_detalle` INT NOT NULL,
  `id_producto_detalle_pedido` INT NOT NULL,
  PRIMARY KEY (`id_detallePedido`),
  UNIQUE INDEX `id_detallePedido_UNIQUE` (`id_detallePedido` ASC) ,
  INDEX `id_producto_detalle_pedido_idx` (`id_producto_detalle_pedido` ASC) ,
  INDEX `id_pedido_detalle_idx` (`id_pedido_detalle` ASC) ,
  CONSTRAINT `id_producto_detalle_pedido`
    FOREIGN KEY (`id_producto_detalle_pedido`)
    REFERENCES `feriacalzado`.`productos` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `id_pedido_detalle`
    FOREIGN KEY (`id_pedido_detalle`)
    REFERENCES `feriacalzado`.`pedido` (`id_pedido`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE TABLE `ventas` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `id_detalle_pedido` INT NOT NULL,
  `status` VARCHAR(20) NOT NULL,
  `id_pago` INT(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `id_UNIQUE` (`id` ASC) ,
  CONSTRAINT `id_detalle_pedido`
    FOREIGN KEY (`id_detalle_pedido`)
    REFERENCES `feriacalzado`.`detalle_pedido` (`id_detallePedido`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
AUTO_INCREMENT = 19
DEFAULT CHARACTER SET = latin1;

CREATE TABLE `aviso` (
  `id_aviso` INT NOT NULL AUTO_INCREMENT,
  `id_usuario_aviso` INT NOT NULL,
  `mensaje` VARCHAR(250) NOT NULL,
  PRIMARY KEY (`id_aviso`),
  UNIQUE INDEX `id_aviso_UNIQUE` (`id_aviso` ASC) ,
  CONSTRAINT `id_usuario_aviso`
    FOREIGN KEY (`id_usuario_aviso`)
    REFERENCES `feriacalzado`.`usuario` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE TABLE `proveedores` (
  `id_proveedor` INT NOT NULL AUTO_INCREMENT,
  `nombre` VARCHAR(250) NOT NULL,
  `rut` VARCHAR(45) NOT NULL,
  `telefono` VARCHAR(45) NOT NULL,
  `direccion` VARCHAR(100) NOT NULL,
  `ciudad` VARCHAR(45) NOT NULL,
  `region` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`id_proveedor`),
  UNIQUE INDEX `id_cliente_UNIQUE` (`id_proveedor` ASC) )
ENGINE = InnoDB;

CREATE TABLE `movimiento` (
  `id_movimiento` INT NOT NULL AUTO_INCREMENT,
  `tipo_movimiento` VARCHAR(45) NOT NULL,
  `id_usuario_movimiento` INT NOT NULL,
  `fechaHora` DATETIME NOT NULL,
  `observaciones` VARCHAR(250) NOT NULL,
  `id_proveedor` INT NOT NULL,
  PRIMARY KEY (`id_movimiento`),
  UNIQUE INDEX `id_movimiento_UNIQUE` (`id_movimiento` ASC) ,
  INDEX `id_proveedor_idx` (`id_proveedor` ASC) ,
  CONSTRAINT `id_usuario_movimiento`
    FOREIGN KEY (`id_usuario_movimiento`)
    REFERENCES `feriacalzado`.`usuario` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `id_proveedor`
    FOREIGN KEY (`id_proveedor`)
    REFERENCES `feriacalzado`.`proveedores` (`id_proveedor`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE TABLE `movimiento_detalle` (
  `id_movimientoDetalle` INT NOT NULL AUTO_INCREMENT,
  `cantidad` INT NOT NULL,
  `observacion_por_producto` VARCHAR(250) NULL,
  `id_movimiento_fk` INT NOT NULL,
  `id_producto_movimiento_detalle` INT NOT NULL,
  PRIMARY KEY (`id_movimientoDetalle`),
  UNIQUE INDEX `id_movimientoDetalle_UNIQUE` (`id_movimientoDetalle` ASC) ,
  CONSTRAINT `id_movimiento_fk`
    FOREIGN KEY (`id_movimiento_fk`)
    REFERENCES `feriacalzado`.`movimiento` (`id_movimiento`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `id_producto_movimiento_detalle`
    FOREIGN KEY (`id_producto_movimiento_detalle`)
    REFERENCES `feriacalzado`.`productos` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE TABLE `num_calzado` (
  `id_numCalzado` INT NOT NULL AUTO_INCREMENT,
  `id_producto_num_calzado` INT NOT NULL,
  `numero` INT NOT NULL,
  `stock` INT NOT NULL,
  PRIMARY KEY (`id_numCalzado`),
  UNIQUE INDEX `id_calzado_UNIQUE` (`id_numCalzado` ASC) ,
  INDEX `id_producto_num_calzado_idx` (`id_producto_num_calzado` ASC) ,
  CONSTRAINT `id_producto_num_calzado`
    FOREIGN KEY (`id_producto_num_calzado`)
    REFERENCES `feriacalzado`.`productos` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE TABLE `detalle_producto` (
  `id_detalle_producto` INT NOT NULL AUTO_INCREMENT,
  `id_producto_detalle_producto` INT NOT NULL,
  `detalle_producto` VARCHAR(250) NULL,
  PRIMARY KEY (`id_detalle_producto`),
  UNIQUE INDEX `id_detalle_producto_UNIQUE` (`id_detalle_producto` ASC) ,
  INDEX `id_producto_detalle_producto_idx` (`id_producto_detalle_producto` ASC) ,
  CONSTRAINT `id_producto_detalle_producto`
    FOREIGN KEY (`id_producto_detalle_producto`)
    REFERENCES `feriacalzado`.`productos` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;